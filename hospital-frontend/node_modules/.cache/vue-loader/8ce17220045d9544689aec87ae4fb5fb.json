{"remainingRequest":"/Users/xuechao6/Desktop/Trad/016-医院挂号系统/016-医院管理系统/源码/hospital-frontend/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/xuechao6/Desktop/Trad/016-医院挂号系统/016-医院管理系统/源码/hospital-frontend/src/views/order/OrderOperate.vue?vue&type=style&index=0&id=411153b1&scoped=true&lang=scss","dependencies":[{"path":"/Users/xuechao6/Desktop/Trad/016-医院挂号系统/016-医院管理系统/源码/hospital-frontend/src/views/order/OrderOperate.vue","mtime":1700395042000},{"path":"/Users/xuechao6/Desktop/Trad/016-医院挂号系统/016-医院管理系统/源码/hospital-frontend/node_modules/css-loader/dist/cjs.js","mtime":1713934404396},{"path":"/Users/xuechao6/Desktop/Trad/016-医院挂号系统/016-医院管理系统/源码/hospital-frontend/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1713934404154},{"path":"/Users/xuechao6/Desktop/Trad/016-医院挂号系统/016-医院管理系统/源码/hospital-frontend/node_modules/postcss-loader/src/index.js","mtime":1713934404275},{"path":"/Users/xuechao6/Desktop/Trad/016-医院挂号系统/016-医院管理系统/源码/hospital-frontend/node_modules/sass-loader/dist/cjs.js","mtime":1713934405905},{"path":"/Users/xuechao6/Desktop/Trad/016-医院挂号系统/016-医院管理系统/源码/hospital-frontend/node_modules/cache-loader/dist/cjs.js","mtime":1713934405844},{"path":"/Users/xuechao6/Desktop/Trad/016-医院挂号系统/016-医院管理系统/源码/hospital-frontend/node_modules/vue-loader/lib/index.js","mtime":1713934404154}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CnVsIGxpIHsKICBkaXNwbGF5OiBpbmxpbmU7Cn07Ci5lbC1icmVhZGNydW1iewogIG1hcmdpbjo4cHg7Cn0KLmRpc2FibGVkIHsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjZGRkOwogIGJvcmRlci1jb2xvcjogI2RkZDsKICBjb2xvcjogYmxhY2s7CiAgY3Vyc29yOiBub3QtYWxsb3dlZDsgLy8g6byg5qCH5Y+Y5YyWCiAgcG9pbnRlci1ldmVudHM6IG5vbmU7Cn0KLnJvdXRlci12aWV3IHsKICBtYXJnaW4tdG9wOiAyMHB4Owp9Ci5zZWN0aW9uVWwgbGkgewogIGRpc3BsYXk6IGlubGluZTsKICBwYWRkaW5nOiA2MHB4Owp9Ci5kYXRlVWwgbGkgewogIGRpc3BsYXk6IGlubGluZTsKICBtYXJnaW46IDVweDsKICBwYWRkaW5nOiAxcHg7Cn0KdWwgbGkgewogIGRpc3BsYXk6IGlubGluZTsKfTsKLmVsLWJyZWFkY3J1bWJ7CiAgbWFyZ2luOjhweDsKfQo="},{"version":3,"sources":["OrderOperate.vue"],"names":[],"mappings":";AAibA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"OrderOperate.vue","sourceRoot":"src/views/order","sourcesContent":["<!--\n * 病患挂号科室选择页面\n *\n * @Author: ShanZhu\n * @Date: 2023-11-17\n-->\n<template>\n<div>\n  <el-card>\n\n    <span style=\"color: #2b5d88\">请选择科室进行挂号</span>\n\n    <el-divider></el-divider>\n\n    <!--科室选择 -->\n    <el-tabs type=\"border-card\">\n      <el-tab-pane label=\"内科\">\n        <ul>\n          <li v-for=\"inter in inters\" :key=\"inter\">\n            <el-button type=\"success\" plain key=\"inter-button\"  style=\"margin: 5px;\" @click=\"sectionClick(inter)\">{{ inter }}</el-button>\n          </li>\n        </ul>\n      </el-tab-pane>\n      <el-tab-pane label=\"外科\">\n        <ul>\n          <li v-for=\"out in outs\" :key=\"out\">\n            <el-button type=\"success\" plain style=\"margin: 5px;\" @click=\"sectionClick(out)\">{{ out }}</el-button>\n          </li>\n        </ul>\n      </el-tab-pane>\n      <el-tab-pane label=\"妇产科\">\n        <ul>\n          <li v-for=\"woman in women\" :key=\"woman\">\n            <el-button type=\"success\" plain style=\"margin: 5px;\" @click=\"sectionClick(woman)\">{{ woman }}</el-button>\n          </li>\n        </ul>\n      </el-tab-pane>\n      <el-tab-pane label=\"儿科\">\n        <ul>\n          <li v-for=\"kid in kids\" :key=\"kid\">\n            <el-button type=\"success\" plain style=\"margin: 5px;\" @click=\"sectionClick(kid)\">{{ kid }}</el-button>\n          </li>\n        </ul>\n      </el-tab-pane>\n      <el-tab-pane label=\"五官科\">\n        <ul>\n          <li v-for=\"five in fives\" :key=\"five\">\n            <el-button type=\"success\" plain style=\"margin: 5px;\" @click=\"sectionClick(five)\">{{ five }}</el-button>\n          </li>\n        </ul>\n      </el-tab-pane>\n      <el-tab-pane label=\"中医科\">\n        <ul>\n          <li v-for=\"chinese in chinese\" :key=\"chinese\">\n            <el-button type=\"success\" plain style=\"margin: 5px;\" @click=\"sectionClick(chinese)\">{{ chinese }}</el-button>\n          </li>\n        </ul>\n      </el-tab-pane>\n      <el-tab-pane label=\"其他\">\n        <ul>\n          <li v-for=\"others in others\" :key=\"others\">\n            <el-button type=\"success\" plain style=\"margin: 5px;\" @click=\"sectionClick(others)\">{{ others }}</el-button>\n          </li>\n        </ul>\n      </el-tab-pane>\n    </el-tabs>\n  </el-card>\n\n  <!--科室医生列表-->\n  <el-card>\n    <div class=\"head\">\n      <div>\n        <i class=\"iconfont icon-doctor-list\" style=\"margin: 5px; color: #2b5d88\">医生列表</i>\n        <span style=\"color: #2b5d88\">（科室：<span style=\"color: #e75c09\">{{section}}</span> 挂号时间：<span style=\"color: #e75c09\">{{orderDate}}</span>）</span>\n      </div>\n\n      <el-divider></el-divider>\n\n      <!-- 选择挂号时间 -->\n      <div>\n        <ul class=\"dateUl\">\n          <li v-for=\"monthDay in monthDays\" :key=\"monthDay\">\n            <el-button\n                size=\"mini\"\n                type=\"primary\" plain\n                @click=\"dateClick(monthDay)\"\n            >\n              {{ monthDay }}</el-button>\n          </li>\n        </ul>\n      </div>\n    </div>\n\n    <br/>\n    <!-- 表格 -->\n    <el-table :data=\"sectionData\" size=\"small\" stripe style=\"width: 100%\" border>\n      <el-table-column type=\"index\" label=\"序号\"width=\"60\"/>\n      <el-table-column prop=\"dId\" label=\"工号\" width=\"80\"/>\n      <el-table-column prop=\"dName\" label=\"姓名\" width=\"80\"/>\n      <el-table-column prop=\"dGender\" label=\"性别\" width=\"60\"/>\n      <el-table-column prop=\"dPost\" label=\"职位\" width=\"100\"/>\n      <el-table-column prop=\"dSection\" label=\"科室\" width=\"100\"/>\n      <el-table-column prop=\"dIntroduction\" label=\"简介\" />\n      <el-table-column prop=\"dPrice\" label=\"挂号费用/元\" width=\"100\"/>\n      <el-table-column prop=\"dAvgStar\" label=\"评价/5分\" width=\"80\"/>\n      <el-table-column label=\"操作\" width=\"140\" v-if=\"clickTag\">\n        <template slot-scope=\"scope\">\n          <el-button\n              class=\"iconfont icon-register-button\"\n              style=\"font-size: 14px\"\n              size=\"mini\"\n              type=\"primary\"\n              @click=\"openClick(scope.row.dId, scope.row.dName)\"\n          >\n            挂号</el-button\n          >\n        </template>\n      </el-table-column>\n    </el-table>\n  </el-card>\n  <!-- 挂号对话框 -->\n  <el-dialog title=\"填写挂号信息\" :visible.sync=\"orderFormVisible\">\n    <el-form :model=\"orderForm\" ref=\"orderForm\" :rules=\"orderRules\">\n      <el-form-item\n          label=\"挂号时间段\"\n          label-width=\"100px\"\n          prop=\"oTime\"\n      >\n        <el-select\n            v-model=\"orderForm.oTime\"\n            placeholder=\"请选择\"\n            no-data-text=\"请尝试预约明日\"\n        >\n          <el-option\n              v-for=\"time in times\"\n              :key=\"time\"\n              :label=\"time\"\n              :value=\"time\"\n          >\n          </el-option>\n        </el-select>\n      </el-form-item>\n      <el-form-item label=\"挂号日期\" label-width=\"100px\">\n        <el-input\n            v-model=\"orderForm.orderDate\"\n            autocomplete=\"off\"\n            disabled\n        ></el-input>\n      </el-form-item>\n      <el-form-item label=\"医生工号\" label-width=\"100px\">\n        <el-input\n            v-model=\"orderForm.dId\"\n            autocomplete=\"off\"\n            disabled\n        ></el-input>\n      </el-form-item>\n      <el-form-item label=\"医生姓名\" label-width=\"100px\">\n        <el-input\n            v-model=\"orderForm.dName\"\n            autocomplete=\"off\"\n            disabled\n        ></el-input>\n      </el-form-item>\n      <el-form-item label=\"患者姓名\" label-width=\"100px\">\n        <el-input\n            v-model=\"orderForm.pName\"\n            autocomplete=\"off\"\n            disabled\n        ></el-input>\n      </el-form-item>\n      <el-form-item label=\"患者身份证号\" label-width=\"100px\">\n        <el-input\n            v-model=\"orderForm.pCard\"\n            autocomplete=\"off\"\n            disabled\n        ></el-input>\n      </el-form-item>\n    </el-form>\n    <div slot=\"footer\" class=\"dialog-footer\">\n      <el-button @click=\"orderFormVisible = false\" style=\"font-size: 18px;\">\n        <i class=\"iconfont icon-cancel-button\" style=\"font-size: 20px;\"></i> 取 消\n      </el-button>\n      <el-button type=\"primary\" @click=\"orderSuccess('orderForm')\"style=\"font-size: 18px;\">\n        <i class=\"iconfont icon-sure-button\" style=\"font-size: 20px;\"></i> 确 定\n      </el-button>\n    </div>\n  </el-dialog>\n\n\n  </div>\n</template>\n<script>\nimport request from \"@/utils/request\";\nimport jwtDecode from \"jwt-decode\";\nimport {getToken} from \"@/utils/storage\";\n\nexport default {\n  name: \"orderOperate\",\n  data() {\n    return {\n      //科室数据\n      section:\"\",\n      inters: [\n        \"神经内科\",\n        \"呼吸与危重症医学科\",\n        \"内分泌科\",\n        \"消化内科\",\n        \"心血管内科\",\n        \"肾内科\",\n        \"发热门诊\",\n      ],\n      outs: [\n        \"手足外科\",\n        \"普通外科\",\n        \"肛肠外科\",\n        \"神经外科\",\n        \"泌尿外科\",\n        \"骨科\",\n        \"烧伤整形外科\",\n      ],\n      women: [\"妇科\", \"产科\"],\n      kids: [\"儿科\", \"儿童保健科\"],\n      fives: [\"耳鼻咽喉科\", \"眼科\", \"口腔科\"],\n      chinese: [\"中医科\"],\n      others: [\"康复医学科\", \"急诊科\", \"皮肤性病科\", \"功能科\"],\n      //医生列表数据\n      sectionOpt: this.$route.query.sectionOpt,\n      sectionData: [],\n      monthDays: [],\n      clickTag: false,\n      orderFormVisible: false,\n      orderForm: { orderDate: \"\" },\n      times: [],\n      orderRules: {\n        oTime: [\n          { required: true, message: \"选择时间段\", trigger: \"blur\" },\n        ],\n      },\n      //挂号日期\n      orderDate: \"\",\n      //拼接时间和日期成为oId\n      idTime: \"\",\n    };\n  },\n  methods: {\n    //点击科室\n    sectionClick(sectionOpt){\n      //获取当天的后7天\n      this.monthDays = [];\n      for (var i = 0; i < 7; i++) {\n        this.nowDay(i);\n      }\n      this.section = sectionOpt;\n      //日期已经选了时候，请求当日值班科室医生\n      if(this.orderDate != undefined){\n        request\n            .get(\"/arrange/findByTime\", {\n              params: {\n                arTime: this.orderDate,\n                dSection: this.section,\n              },\n            })\n            .then((res) => {\n              this.sectionData = res.data.data.map((item) => item.doctor);\n            });\n      }\n\n      // 解码token\n      this.orderForm.pName = this.tokenDecode(getToken()).pName;\n      this.orderForm.pCard = this.tokenDecode(getToken()).pCard;\n      this.orderForm.pId = this.tokenDecode(getToken()).pId;\n    },\n    //打开挂号对话框触发,获取挂号时间段已剩余票数\n    requestTime(id) {\n      this.idTime = id + this.orderDate;\n      request\n          .get(\"order/findOrderTime\", {\n            params: {\n              arId: this.idTime,\n            },\n          })\n          .then((res) => {\n            const date = new Date(this.orderDate);\n            const today = new Date();\n            const isToday =\n                date.getFullYear() === today.getFullYear() &&\n                date.getMonth() === today.getMonth() &&\n                date.getDate() === today.getDate();\n            var array = [];\n            if (!this.isTimeAfterTarget(\"09:30\") || !isToday) {\n              array.push(\n                  \"08:30-09:30  \" + \"   余号 \" + \"1\"\n              );\n            }\n            if (!this.isTimeAfterTarget(\"10:30\") || !isToday) {\n              array.push(\n                  \"09:30-10:30  \" + \"   余号 \" + \"1\"\n              );\n            }\n            if (!this.isTimeAfterTarget(\"11:30\") || !isToday) {\n              array.push(\n                  \"10:30-11:30  \" + \"   余号 \" + \"1\"\n              );\n            }\n            if (!this.isTimeAfterTarget(\"15:30\") || !isToday) {\n              array.push(\n                  \"14:30-15:30  \" + \"   余号 \" + \"1\"\n              );\n            }\n            if (!this.isTimeAfterTarget(\"16:30\") || !isToday) {\n              array.push(\n                  \"15:30-16:30  \" + \"   余号 \" + \"1\"\n              );\n            }\n            if (!this.isTimeAfterTarget(\"17:30\") || !isToday) {\n              array.push(\n                  \"16:30-17:30  \" + \"   余号 \" + \"1\"\n              );\n            }\n            this.times = array;\n          });\n    },\n    isTimeAfterTarget(timeString) {\n      // 判断时间是否超过timeString(入参格式如：09:30)\n      const currentTime = new Date();\n\n      // 解析传入的目标时间字符串，获取小时和分钟\n      const [targetHour, targetMinute] = timeString.split(\":\");\n\n      // 设置要比较的时间\n      const targetTime = new Date();\n      targetTime.setHours(targetHour);\n      targetTime.setMinutes(targetMinute);\n      targetTime.setSeconds(0);\n\n      // 比较当前时间是否超过了目标时间\n      return currentTime > targetTime;\n    },\n    //挂号点击确认\n    orderSuccess(formName) {\n      this.$refs[formName].validate((valid) => {\n        if (valid) {\n          request\n              .get(\"patient/addOrder\", {\n                params: {\n                  pId: this.orderForm.pId,\n                  dId: this.orderForm.dId,\n                  oStart:\n                      this.orderForm.orderDate +\n                      \" \" +\n                      this.orderForm.oTime,\n                  arId: this.idTime,\n                },\n              })\n              .then((res) => {\n                if (res.data.status != 200)\n                  return this.$message.error(\n                      res.data.msg\n                  );\n                this.orderFormVisible = false;\n                this.$message.success(\"挂号成功！\");\n                this.orderForm.oTime = '';\n              });\n        } else {\n          return false;\n        }\n      });\n    },\n    //token解码\n    tokenDecode(token) {\n      if (token !== null) return jwtDecode(token);\n    },\n    //打开挂号对话框\n    openClick(id, name) {\n      this.orderForm.dId = id;\n      this.orderForm.dName = name;\n      this.orderFormVisible = true;\n      //请求挂号时间段\n      this.requestTime(id);\n    },\n    //选择日期触发时间\n    dateClick(date) {\n      //获取挂号年月日\n      const nowDate = new Date();\n      let year = nowDate.getFullYear();\n      this.orderForm.orderDate = year + \"-\" + date;\n      let dateYear = year + \"-\" + date;\n      this.orderDate = dateYear;\n      request\n          .get(\"/arrange/findByTime\", {\n            params: {\n              arTime: dateYear,\n              dSection: this.section,\n            },\n          })\n          .then((res) => {\n            this.sectionData = res.data.data.map((item) => item.doctor);\n            this.clickTag = true;\n          });\n    },\n    //获取当天及后7天的日期星期\n    nowDay(num) {\n      var nowDate = new Date();\n      var currentHour = nowDate.getHours();\n      var currentMinute = nowDate.getMinutes();\n\n      // 判断当前时间是否已经过了17:30\n      if (\n          currentHour > 17 ||\n          (currentHour === 17 && currentMinute > 30)\n      ) {\n        num++; // 次日\n      }\n\n      nowDate.setDate(nowDate.getDate() + num);\n      let month = nowDate.getMonth() + 1;\n      let date = nowDate.getDate();\n      if (date < 10) {\n        date = \"0\" + date;\n      }\n      if (month < 10) {\n        month = \"0\" + month;\n      }\n      var time = month + \"-\" + date;\n\n      this.monthDays.push(time);\n    },\n\n  },\n};\n</script>\n\n<style scoped lang=\"scss\">\nul li {\n  display: inline;\n};\n.el-breadcrumb{\n  margin:8px;\n}\n.disabled {\n  background-color: #ddd;\n  border-color: #ddd;\n  color: black;\n  cursor: not-allowed; // 鼠标变化\n  pointer-events: none;\n}\n.router-view {\n  margin-top: 20px;\n}\n.sectionUl li {\n  display: inline;\n  padding: 60px;\n}\n.dateUl li {\n  display: inline;\n  margin: 5px;\n  padding: 1px;\n}\nul li {\n  display: inline;\n};\n.el-breadcrumb{\n  margin:8px;\n}\n</style>\n"]}]}